var base64=base64||function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),i=!function(){var n={};return $.each(t,function(t,i){n[i]=t}),n}(),n={};return n.encode=function(n){for(var i=[],f=t,e=n.length,r,u=0;u<e;)r=n[u]<<16|n[u+1]<<8|n[u+2],i.push(f[r>>18],f[r>>12&63],f[r>>6&63],f[r&63]),u+=3;return e%3==1?(i.pop(),i.pop(),i.push("=","=")):(i.pop(),i.push("=")),i.join("")},n.decode=function(n){var e=[],t=n.split(""),u=i,o=t.length,f,r=0;if(o%4)return null;while(r<o)f=u[t[r]]<<18|u[t[r+1]]<<12|u[t[r+2]]<<6|u[t[r+3]],e.push(f>>16,f>>8&255,f&255),r+=4;while(t[--o]=="=")e.pop();return e},n.encodeArrayBuffer=function(n){for(var i=new DataView(n),u=i.byteLength,r=[],t=0;t<u;t++)r.push(i.getUint8(t));return base64.encode(r)},n.toObjectUrl=function(n,t){return"data:"+t+";base64,"+n},n}();$(function(){var t=!1,i=0,n;document.addEventListener("ajaxproxy",function(r){var o=r.detail,f=o.data,u={success:null,status:null,statusText:null,url:f.url,text:null,model:null,request:f,index:o.index},e;f.headers=f.headers||{};f.headers&&(e={},$.each(f.headers,function(n,t){e["Fish-"+n]=t}),f.headers=e);f.refer&&(f.headers["Fish-Referer"]=f.refer);f.headers["Fish-User-Agent"]="Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)";f.headers["Fish-Origin"]=/(https?:\/\/[^\/]+\/)/i.exec(f.url)[1];f.headers["Fish-Referer"]||(f.headers["Fish-Referer"]=null);t&&f.url.indexOf("leftTicket/query")!==-1&&i++%3!=0&&localStorage.noDirectAccess!=="1"?chrome.runtime.sendMessage({action:"directAccess",data:f},function(t){(function(t,i,r,f,e,o){u.success=t;u.status=i;u.statusText=r||"";u.text=f||"";u.model=o;u.headers=e;n(u)}).apply(this,t)}):$.ajax(f).done(function(t,i,r){u.success=!0;u.status=r.status;u.statusText=r.statusText;u.text=r.responseText;u.model=t;u.headers=r.getAllResponseHeaders();n(u)}).fail(function(t){u.success=!1;u.status=t.status;u.statusText=t.statusText||"";u.text=t.responseText||"";u.model=null;u.headers=t.getAllResponseHeaders();n(u)});r.preventDefault&&r.preventDefault();r.stopPropagation&&r.stopPropagation()});n=function(n){var t=new CustomEvent("ajaxproxyfinished",{detail:n});document.dispatchEvent(t)};document.addEventListener("ajaxLoadVerifyCode",function(n){var i=n.detail,t=new XMLHttpRequest;t.open("GET",i.url,!0);t.onreadystatechange=function(){if(t.readyState===4)if(t.status!==200)document.dispatchEvent(new CustomEvent("ajaxproxyfinished",{detail:{url:null,success:!1,index:i.index,headers:t.getAllResponseHeaders()}}));else{var n=base64.toObjectUrl(base64.encodeArrayBuffer(t.response),"image/jpeg");document.dispatchEvent(new CustomEvent("ajaxproxyfinished",{detail:{url:n,success:!0,index:i.index,headers:t.getAllResponseHeaders()}}))}};t.responseType="arraybuffer";t.setRequestHeader("Fish-Referer",i.refer);t.setRequestHeader("Fish-User-Agent","Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)");t.setRequestHeader("Fish-Origin",/(https?:\/\/[^\/]+\/)/.exec(i.url)[1]);i.headers&&$.each(i.headers,function(n,i){t.setRequestHeader("Fish-"+n,i)});t.send(i.data||null);n.preventDefault&&n.preventDefault();n.stopPropagation&&n.stopPropagation()});document.body.dataset.targetExtensionId=chrome.runtime.id;document.body.dataset.targetExtensionVersion=chrome.runtime.getManifest().version;document.body.dataset.mobileSupportInitialized=1;chrome.runtime.sendMessage({action:"getBv"},function(n){document.body.dataset.browserVersion=n.bv;document.dispatchEvent(new CustomEvent("mobileSupportInitialized"))});chrome.runtime.sendMessage({action:"servervalid"},function(n){(console.log("liebao detected: "+n.valid),n.valid)&&chrome.runtime.sendMessage({action:"getServerStatus"},function(n){t=n.enableDirectAccess;console.log("direct access: "+t)})})})